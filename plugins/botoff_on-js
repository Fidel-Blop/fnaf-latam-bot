const fs = require("fs");

// Archivo donde guardamos los grupos "apagados"
const dbFile = "./database/gruposOff.json";

// Cargar base de datos (si no existe, la crea vacía)
function loadDB() {
  if (!fs.existsSync(dbFile)) return [];
  return JSON.parse(fs.readFileSync(dbFile));
}

// Guardar cambios en la base
function saveDB(data) {
  fs.writeFileSync(dbFile, JSON.stringify(data, null, 2));
}

module.exports = {
  name: "onoff",
  alias: ["boton", "botoff", "boton"], // podés editar
  desc: "Activa o desactiva el bot en el grupo",
  run: async (conn, m, { text, isGroup, from }) => {
    if (!isGroup) return m.reply("⚠️ Este comando solo funciona en grupos.");

    let gruposOff = loadDB();
    let index = gruposOff.indexOf(from);

    if (text.toLowerCase() === "on") {
      if (index !== -1) {
        gruposOff.splice(index, 1); // lo saco de la lista
        saveDB(gruposOff);
      }
      return m.reply("✅ Bot activado en este grupo.");
    }

    if (text.toLowerCase() === "off") {
      if (index === -1) {
        gruposOff.push(from); // lo agrego a la lista
        saveDB(gruposOff);
      }
      return m.reply("⛔ Bot desactivado en este grupo.");
    }

    m.reply("Usa: `bot on` o `bot off`");
  }
};
